<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html lang="es" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:pe="http://primefaces.org/ui/extensions"
      xmlns:o="http://omnifaces.org/ui">
    <ui:composition>
    <h:form id="metasCreateUpdateForm">
    	<p:panel header="INDICADOR #{metasView.indicadorSelected.name}">
    			<p:commandButton value="Regresar" style="margin-bottom: 5px;margin-top: 5px;" type="button" onclick="PF('main_list_panel').show(), PF('detail_list_panel').close()" /> 
	            
	            <p:panelGrid columns="2" id="headerPanel"  layout="grid">
					<p:column>
						<h:outputLabel value="TIPO DE INDICADOR: " for="tipoIndicador"/>
					</p:column>
					<p:column>
						<p:inputText id="tipoIndicador"
										value="#{metasView.indicadorSelected.evaluationPeriod.description}"
										style="width:50%" disabled="true" />
					</p:column>
					
					<p:column>
						<h:outputLabel value="UNIDAD DE MEDIDA: " for="unidadMedida"/>
					</p:column>
					<p:column>
						<p:inputText id="unidadMedida"
										value="#{metasView.indicadorSelected.unidadMedida.description}"
										style="width:50%" disabled="true" />
					</p:column>
					
					
					<p:column rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'AL'}">
						<h:outputLabel value="AÑO: " for="anio"/>
					</p:column>
					<p:column rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'AL'}">
						
						<p:selectOneMenu 
							id="anio"
							rendered="#{metasView.status.code ==  1}"
							value="#{metasView.newMetaForIndicador.ordinalDate}" >
							<f:selectItem itemLabel="Seleccionar periodo" itemValue="" />
							<f:selectItems value="#{of:createIntegerArray(of:formatDate(now,'yyyy'),of:formatDate(now,'yyyy')+3)}" />
						</p:selectOneMenu>
						
						<p:selectOneMenu 
							id="anioUpdate"
							rendered="#{metasView.status.code ==  2}"  
							disabled="true"
							value="#{metasView.metaSelected.ordinalDate}"  >
							<f:selectItem itemLabel="Seleccionar periodo" itemValue="" />
							<f:selectItems value="#{of:createIntegerArray(of:formatDate(now,'yyyy'),of:formatDate(now,'yyyy')+3)}" />
						</p:selectOneMenu>
						
						<p:message for="anio" rendered="#{metasView.status.code ==  1}" />
						<p:message for="anioUpdate" rendered="#{metasView.status.code ==  2}" />
					</p:column>
					
					<p:column rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'TRIME'}">
						<h:outputLabel value="TRIMESTRE: " for="cmbTrime"/>
					</p:column>
					<p:column rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'TRIME'}">
						<p:selectOneMenu 
								id="cmbTrime"
								style="width:45%"
								rendered="#{metasView.status.code ==  1}"
								value="#{metasView.newMetaForIndicador.ordinalDate}" required="true"
								requiredMessage="seleccinar trimestre">
								<f:selectItem itemValue="" itemLabel="Seleccionar trimestre" />
								<f:selectItems value="#{metasView.trimestres}" var="trime"
									itemValue="#{trime.code}" itemLabel="#{trime.description}" />
						</p:selectOneMenu>
						
						<p:selectOneMenu 
								id="cmbTrimeUpdate"
								style="width:45%"
								disabled="true"
								rendered="#{metasView.status.code ==  2}"
								value="#{metasView.metaSelected.ordinalDate}" required="true"
								requiredMessage="seleccinar trimestre">
								<f:selectItem itemValue="" itemLabel="Seleccionar trimestre" />
								<f:selectItems value="#{metasView.trimestres}" var="trime"
									itemValue="#{trime.code}" itemLabel="#{trime.description}" />
						</p:selectOneMenu>
						
						<p:message for="cmbTrime" rendered="#{metasView.status.code ==  1}" />
						<p:message for="cmbTrimeUpdate" rendered="#{metasView.status.code ==  2}" />
					</p:column>
					
					<p:column rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'ME'}">
						<h:outputLabel value="MES: " for="cmbMes"/>
					</p:column>
					<p:column rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'ME'}">
						<p:selectOneMenu 
								id="cmbMes"
								style="width:45%"
								rendered="#{metasView.status.code ==  1}"
								value="#{metasView.newMetaForIndicador.ordinalDate}" required="true"
								requiredMessage="seleccinar mes">
								<f:selectItem itemValue="" itemLabel="Seleccionar mes" />
								<f:selectItems value="#{metasView.meses}" var="mes"
									itemValue="#{mes.code}" itemLabel="#{mes.description}" />
						</p:selectOneMenu>
						
						<p:selectOneMenu 
								id="cmbMesUpdate"
								style="width:45%"
								disabled="true"
								rendered="#{metasView.status.code ==  2}"
								value="#{metasView.metaSelected.ordinalDate}" required="true"
								requiredMessage="seleccinar mes">
								<f:selectItem itemValue="" itemLabel="Seleccionar mes" />
								<f:selectItems value="#{metasView.meses}" var="mes"
									itemValue="#{mes.code}" itemLabel="#{mes.description}" />
						</p:selectOneMenu>
						
						<p:message for="cmbMes" rendered="#{metasView.status.code ==  1}" />
						<p:message for="cmbMesUpdate" rendered="#{metasView.status.code ==  2}" />
					</p:column>
					
					<p:column>
						<h:outputLabel value="META: " for="meta"/>
					</p:column>
					
					<p:column>
						<p:inputText id="meta"
										value="#{metasView.newMetaForIndicador.meta}"
										style="width:50%"
										rendered="#{metasView.status.code ==  1}">
							<f:converter converterId="javax.faces.Double" /> 
						</p:inputText>
						
						<p:inputText id="metaUpdate"
										value="#{metasView.metaSelected.meta}"
										style="width:50%"
										rendered="#{metasView.status.code ==  2}">
							<f:converter converterId="javax.faces.Double" /> 
						</p:inputText>
						
						<p:message for="meta" rendered="#{metasView.status.code ==  1}" />
						<p:message for="metaUpdate" rendered="#{metasView.status.code ==  2}" />
					</p:column>
					
					<p:column>
						<h:outputLabel value="ACCIÓN:"/>
					</p:column>
					
					<p:column>
						<p:commandButton
							actionListener="#{metasView.persitMeta}"
							value="#{safiCommonBundle.Save}"
							update="accordion:metasTable metasCreateUpdateForm"
							validateClient="true"
							rendered="#{metasView.status.code ==  1 or metasView.status.code ==  2}">
							<p:confirm header="#{safiCommonBundle.ConfirmationHeader}"
								message="#{safiCommonBundle.ConfirmCreateMessage}" icon="ui-icon-alert" />
						</p:commandButton>
					</p:column>
				</p:panelGrid>
        	</p:panel>
		<p:accordionPanel id="accordion" widgetVar="accordion" multiple="true" activeIndex="0" >
        	<p:tab title="METAS">
        		 
        		 <p:contextMenu id="ctxMetas" for="metasCreateUpdateForm:accordion:metasTable">
						<p:menuitem value="Editar" icon="fa fa-pencil"
									process="@this metasTable"
									actionListener="#{metasView.preparedEditMeta}"
									update="metasCreateUpdateForm" />
						
						<p:menuitem value="Eliminar" icon="fa fa-trash"
							process="@this metasTable" update="metasTable" 
							actionListener="#{metasView.deleteMeta}">
								<p:confirm header="Eliminacion"
									message="Desea eliminar este registro?" />
						</p:menuitem>
					</p:contextMenu>
        	
	            <p:dataTable id="metasTable" widgetVar="metasTable" value="#{metasView.lazyMetasModel}"
	                        var="metas" rowIndexVar="indice" 
	                        rowKey="#{metas.id}"
	                        selection="#{metasView.metaSelected}" selectionMode="single"
	                        lazy="true"
	                        emptyMessage="#{safiCommonBundle.ListEmpty}" 
	                        paginator="true" rows="10" paginatorPosition="bottom"
	                      	paginatorTemplate="{FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
	                        currentPageReportTemplate="| #{safiCommonBundle.page} {currentPage} #{safiCommonBundle.of} {totalPages} |" 
	                        rowsPerPageTemplate="10,20,30,40"> 
	                        
	                    <p:column headerText="Año" rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'AL'}">
				        	#{metas.ordinalDate}
				        </p:column>
				        
				        <p:column headerText="Trimestre" rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'TRIME'}">
				        	#{metasView.getTrimestre(metas.ordinalDate)}
				        </p:column>
				        
				        <p:column headerText="Mes" rendered="#{metasView.indicadorSelected.evaluationPeriod.code eq 'ME'}">
				        	#{metasView.getMes(metas.ordinalDate)}
				        </p:column>
		        		
		        		<p:column headerText="Meta" rendered="#{metasView.indicadorSelected.unidadMedida.code eq '#'}">
				        	<h:outputText value="#{metas.meta}" style="text-align: right;display: block;" />
				        </p:column>
				        
				        <p:column headerText="Meta" rendered="#{metasView.indicadorSelected.unidadMedida.code eq '$'}">
				        	<h:outputText value="#{metas.meta}" style="text-align: right;display: block;" >
				        		<f:convertNumber type="currency" currencySymbol="$" />
				        	</h:outputText>
				        </p:column>
				        
				         <p:column headerText="Meta" rendered="#{metasView.indicadorSelected.unidadMedida.code eq '%'}">
				        	<h:outputText value="#{metas.meta}" style="text-align: right;display: block;" >
				        		<f:convertNumber type="percent"/>
				        	</h:outputText>
				         </p:column>
				        
		        </p:dataTable>
        	</p:tab>
			<p:spacer height="10px"/>
		</p:accordionPanel>
	</h:form>
	<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
			<p:commandButton value="Si" type="button"
				styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			<p:commandButton value="No" type="button"
				styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
	</p:confirmDialog>
		
    </ui:composition>
</html>